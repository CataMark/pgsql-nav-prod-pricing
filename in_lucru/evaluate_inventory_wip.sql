do $$
declare
    _by_date date := '2022-03-31'::date;
    _tarif_orar decimal(8,2) := 82.93;
begin
    drop table if exists tbl_tmp_wip_pozitions;
    drop table if exists tbl_tmp_values;

    create temp table tbl_tmp_wip_pozitions(
        locatie text not null,
        comanda text not null,
        reper text not null,
        faza int,
        cantitate decimal(8, 2)
    );
    create unique index if not exists tbl_tmp_wip_pozitions_ix1 on tbl_tmp_wip_pozitions(comanda, reper, faza);

    insert into tbl_tmp_wip_pozitions (locatie, comanda, reper, faza, cantitate)
    values ('AIB','18570','G821001F',160,260),
            ('AIB','18570','G821001P',10,101),
            ('AIB','PO210192','G881009F',160,847),
            ('AIB','PO210225','H631011T',10,130),
            ('AIB','PO210233','G912003X',160,43),
            ('AIB','PO210246','I101011T',10,36),
            ('AIB','PO210258','F931011X',160,107),
            ('AIB','PO210260','F932012X',160,110),
            ('AIB','PO210261','H791008T',10,143),
            ('AIB','PO210261','H791008T',310,224),
            ('AIB','PO210261','H791008T',360,48),
            ('AIB','PO210261','H791010T',10,144),
            ('AIB','PO210275','H721001T',10,28),
            ('AIB','PO210334','H311005X',140,240),
            ('AIB','PO210394','1851005F',160,200),
            ('AIB','PO210394','1851008T',10,176),
            ('AIB','PO210395','PLAPA5016',10,120),
            ('AIB','PO210442','POFPA5008',10,98),
            ('AIB','PO210443','PSUPA5006',10,140),
            ('AIB','PO210536','9041007T',10,55),
            ('AIB','PO210625','9042033U',10,261),
            ('AIB','PO210625','FSES003X',160,41),
            ('AIB','PO210626','9041001F',160,515),
            ('AIB','PO210626','9041007T',10,58),
            ('AIB','PO210630','9051019X',160,137),
            ('AIB','PO210638','G912003X',160,26),
            ('AIB','PO210644','I041001A',10,42),
            ('AIB','PO210709','H291006T',10,135),
            ('AIB','PO210714','BORST0004',4,740),
            ('AIB','PO210761','D561213T',10,63),
            ('AIB','PO210767','PAFCO0440',340,4),
            ('AIB','PO210792','F881001A',210,22),
            ('AIB','PO210854','H741006X',140,24),
            ('AIB','PO210856','LEGFA5002',210,53),
            ('AIB','PO210856','LEGFA5004',210,8),
            ('AIB','PO210856','PICCO5001',500,28),
            ('AIB','PO210874','FURSX5008',140,53),
            ('AIB','PO210874','POFPA5014',10,232),
            ('AIB','PO210874','POFPA5014',200,57),
            ('AIB','PO210926','H321006F',140,630),
            ('AIB','PO210986','FURST5034',140,103),
            ('AIB','PO210994','SOCPA6000',10,63),
            ('AIB','PO211044','TRAFA5001',370,10),
            ('AIB','PO211073','LSEPA5014',10,20),
            ('AIB','PO211074','FURNO5000',140,25),
            ('AIB','PO211122','PICCO5001',500,1007),
            ('AIB','PO211123','BMAPA5001',600,713),
            ('AIB','PO211124','PICCO5000',390,9),
            ('AIB','PO211126','POFPA5008',10,53),
            ('AIB','PO211126','POFPA5008',340,24),
            ('AIB','PO211130','LSEPA5002',340,43),
            ('AIB','PO211130','LSEPA5002',380,34),
            ('AIB','PO211133','PITPA5007',330,4),
            ('AIB','PO211134','PSUPA5009',360,3),
            ('AIB','PO211135','FSEPA5007',390,3),
            ('AIB','PO211138','PINPA5002',310,208),
            ('AIB','PO211141','PLIPA5000',330,4),
            ('AIB','PO211144','D861006F',160,206),
            ('AIB','PO211144','D861007F',160,216),
            ('AIB','PO211145','D861001F',140,670),
            ('AIB','PO211152','C091007T',330,3),
            ('AIB','PO211158','PICCO5006',360,4),
            ('AIB','PO211159','H561001A',390,23),
            ('AIB','PO211159','H561001A',600,84),
            ('AIB','PO211165','PICFA5007',10,30),
            ('AIB','PO211197','H351006T',360,259),
            ('AIB','PO211204','BMACO5001',375,6),
            ('AIB','PO211216','LEGFA5016',320,98),
            ('AIB','PO211216','LEGFA5017',320,50),
            ('AIB','PO211216','PICFA5005',10,600),
            ('AIB','PO211218','LEGFA5015',320,50),
            ('AIB','PO211219','BMAPA5004',10,105),
            ('AIB','PO211221','BLAPR0001',10,209),
            ('AIB','PO211221','ESEPR0002',10,26),
            ('AIB','PO211221','LEGPR0002',10,57),
            ('AIB','PO211221','PLAPR0003',10,160),
            ('AIB','PO211228','LEBVA9000',340,58),
            ('AIB','PO211228','LEBVA9001',340,58),
            ('AIB','PO211232','H171002T',345,18),
            ('AIB','PO211233','H171001A',400,3),
            ('AIB','PO211233','H171001A',600,496),
            ('AIB','PO211246','H271005T',500,24),
            ('AIB','PO211247','H272002X',140,206),
            ('AIB','PO211248','G181004T',210,146),
            ('AIB','PO211256','LEGPA5006',10,90),
            ('AIB','PO211258','G931001F',160,10),
            ('AIB','PO211280','D561213T',10,22),
            ('AIB','PO211282','H551001T',371,413),
            ('AIB','PO211282','H551004T',500,438),
            ('AIB','PO211282','H551008T',370,201),
            ('AIB','PO211282','H551008T',365,212),
            ('AIB','PO211286','H551010T',445,831),
            ('AIB','PO211286','H551010T',530,82),
            ('AIB','PO211291','H741003T',530,13),
            ('AIB','PO211293','H741001T',510,155),
            ('AIB','PO211293','H741001T',520,26),
            ('AIB','PO211296','H741010T',520,354),
            ('AIB','PO211298','H741003F',105,586),
            ('AIB','PO211301','H741001F',105,294),
            ('AIB','PO211303','H741010F',105,1172),
            ('AIB','PO220093','I101003T',320,4),
            ('AIB','PO220097','I101002T',10,67),
            ('AIB','PO220097','I101011T',10,240),
            ('AIB','PO220100','BORST0005',4,836),
            ('AIB','PO220105','H431009T',330,210),
            ('AIB','PO220105','H431010T',330,210),
            ('AIB','PO220153B','G531005T',260,130),
            ('AIB','PO220153B','G531006T',260,130),
            ('AIB','PO220153B','G531007T',401,399),
            ('AIB','PO220153B','G531007T',210,168),
            ('AIB','PO220153B','G531007T',370,4),
            ('AIB','PO220153B','G531008T',210,168),
            ('AIB','PO220153B','G531008T',370,4),
            ('AIB','PO220153B','G531009T',401,379),
            ('AIB','PO220153B','G531009T',350,11),
            ('AIB','PO220154B','G531005T',265,245),
            ('AIB','PO220154B','G531006T',265,245),
            ('AIB','PO220154B','G531008T',401,400),
            ('AIB','PO220154B','G531010T',401,380),
            ('AIB','PO220154B','G531010T',350,13),
            ('AIB','PO220159','H551002T',550,456),
            ('AIB','PO220159','H551003T',550,451),
            ('AIB','PO220159','H551009T',550,832),
            ('AIB','PO220173','H171001A',310,219),
            ('AIB','PO220198','H471001T',530,1239),
            ('AIB','PO220198','H471002T',375,64),
            ('AIB','PO220198','H471002T',500,581),
            ('AIB','PO220198','H471003T',530,544),
            ('AIB','PO220198','H471003T',500,28),
            ('AIB','PO220198','H471005T',330,600),
            ('AIB','PO220199','FSES021X',160,33),
            ('AIB','PO220199','H311010T',500,249),
            ('AIB','PO220199','H311012T',340,80),
            ('AIB','PO220199','H331001T',505,136),
            ('AIB','PO220199','H331002T',505,140),
            ('AIB','PO220200','H311010T',500,226),
            ('AIB','PO220200','H311011T',500,415),
            ('AIB','PO220200','H311012T',340,600),
            ('AIB','PO220200','H321001F',140,824),
            ('AIB','PO220200','H321001T',530,218),
            ('AIB','PO220200','H321008T',375,552),
            ('AIB','PO220200','H321010T',500,469),
            ('AIB','PO220201','H441005T',410,6),
            ('AIB','PO220201','H441006T',410,5),
            ('AIB','PO220201','H441008T',330,360),
            ('AIB','PO220202','H331001T',350,240),
            ('AIB','PO220202','H331002T',350,275),
            ('AIB','PO220202','H351003T',335,126),
            ('AIB','PO220202','H351004T',335,259),
            ('AIB','PO220202','H351005T',350,201),
            ('AIB','PO220202','H351005T',370,68),
            ('AIB','PO220202','H351010T',370,250),
            ('AIB','PO220202','H351012T',330,250),
            ('AIB','PO220203','H321001T',350,972),
            ('AIB','PO220203','H321001T',335,88),
            ('AIB','PO220203','H321002T',350,195),
            ('AIB','PO220203','H321003T',335,315),
            ('AIB','PO220203','H321005T',370,646),
            ('AIB','PO220203','H321006T',370,641),
            ('AIB','PO220203','H321007T',370,604),
            ('AIB','PO220203','H321008T',310,28),
            ('AIB','PO220203','H321008T',340,352),
            ('AIB','PO220203','H321009T',356,309),
            ('AIB','PO220203','H321010T',370,987),
            ('AIB','PO220203','H321011T',350,25),
            ('AIB','PO220203','H321011T',380,624),
            ('AIB','PO220203','H321012T',500,1256),
            ('AIB','PO220205','H431001T',380,134),
            ('AIB','PO220205','H431001T',370,66),
            ('AIB','PO220205','H431002T',380,200),
            ('AIB','PO220205','H431003T',360,418),
            ('AIB','PO220205','H431004T',350,211),
            ('AIB','PO220205','H431005T',340,209),
            ('AIB','PO220205','H431006T',340,617),
            ('AIB','PO220206','H451001T',320,304),
            ('AIB','PO220206','H451003T',320,440),
            ('AIB','PO220206','H451004T',310,130),
            ('AIB','PO220206','H451005T',310,435),
            ('AIB','PO220206','H451006T',330,324),
            ('AIB','PO220207','H391001T',10,236),
            ('AIB','PO220208','H421001T',10,328),
            ('AIB','PO220209','H411001T',10,258),
            ('AIB','PO220242','PICMD0026',560,177),
            ('AIB','PO220242','TABMD0006',560,84),
            ('AIB','PO220242','TABMD0007',560,123),
            ('AIB','PO220248','DSFCO0717ST',530,198),
            ('AIB','PO220248','PANMD0021',560,186),
            ('AIB','PO220248','PLAPA0065',500,203),
            ('AIB','PO220248','PLAPA0066',500,200),
            ('AIB','PO220248','PSPPA0008',500,196),
            ('AIB','PO220248','SOCMD0018',560,200),
            ('AIB','PO220248','SOCMD0019',560,374),
            ('AIB','PO220252','MONMD0025',350,202),
            ('AIB','PO220252','MONMD0026',350,189),
            ('AIB','PO220252','SOCMD0012',510,200),
            ('AIB','PO220252','SOCMD0013',320,317),
            ('AIB','PO220253','FTFME1312',320,199),
            ('AIB','PO220253','POFME1814',320,205),
            ('AIB','PO220253','POFME1815',350,204),
            ('AIB','PO220253','POFME1816',320,206),
            ('AIB','PO220255','FSEMD0039',350,1110),
            ('AIB','PO220255','MONMD0022',320,216),
            ('AIB','PO220255','SOCMD0010',320,168),
            ('AIB','PO220255','SSEPA0005',10,107),
            ('AIB','PO220255','SSEPA0005',320,114),
            ('AIB','PO220255','USAMD0022',320,1266),
            ('AIB','PO220256','DSFCO0709',500,447),
            ('AIB','PO220259','DSFCO0699ST',203,211),
            ('AIB','PO220260','LPAPA5003',350,131),
            ('AIB','PO220260','LPAPA5004',350,88),
            ('AIB','PO220294','H761005T',330,20),
            ('AIB','PO220294','PANPA5000',350,172),
            ('AIB','PO220294','TRAFA5003',330,151),
            ('AIB','PO220300','FURST5131',120,210),
            ('AIB','PO220300','FURST5132',130,105),
            ('AIB','PO220300','FURST5133',120,143),
            ('AIB','PO220304','FURST5133',130,144),
            ('AIB','PO220304','FURST5139',130,210),
            ('AIB','PO220308','H921003T',10,215),
            ('AIB','PO220308','H921005T',10,265),
            ('AIB','PO220310','I041001A',370,3),
            ('AIB','PO220311','I051001A',10,176),
            ('AIB','PO220321','PICFA5004',10,405),
            ('AIB','PO220350','H271004T',520,200),
            ('AIB','PO220350','H271005T',330,25),
            ('AIB','PO220350','H271005T',340,304),
            ('AIB','PO220351','H271001T',360,105),
            ('AIB','PO220351','H271002T',370,432),
            ('AIB','PO220364','PINPA0149',500,205),
            ('AIB','PO220367','MONPA9012',340,416),
            ('AIB','PO220367','MONPA9014',315,55),
            ('AIB','PO220367','MONPA9015',335,414),
            ('AIB','PO220367','PITPA0100',335,612),
            ('AIB','PO220367','PITPA0101',500,190),
            ('AIB','PO220367','POLPA0004',510,238),
            ('AIB','PO220367','POLPA0005',510,181),
            ('AIB','PO220367','PSPHD9002',210,753),
            ('AIB','PO220367','TRAPA0115',320,1342),
            ('AIB','PO220368','MONPA9012',305,66),
            ('AIB','PO220368','MONPA9013',315,92),
            ('AIB','PO220368','PITPA0101',325,94),
            ('AIB','PO220368','PITPA0101',500,112),
            ('AIB','PO220368','POLPA0004',510,370),
            ('AIB','PO220368','PSPHD9002',210,156),
            ('AIB','PO220368','TRAPA0115',320,284),
            ('AIB','PO220375','FUSHD9015',310,83),
            ('AIB','PO220375','LEGPA9000',330,100),
            ('AIB','PO220375','LSEPA9002',360,350),
            ('AIB','PO220375','MONPA9006',340,217),
            ('AIB','PO220375','MONPA9008',350,218),
            ('AIB','PO220375','MONPA9009',340,215),
            ('AIB','PO220375','MONPA9010',350,218),
            ('AIB','PO220375','PITPA9005',330,195),
            ('AIB','PO220375','PITPA9006',330,213),
            ('AIB','PO220375','POFPA9004',10,84),
            ('AIB','PO220375','POFPA9004',520,188),
            ('AIB','PO220375','PSPPA9003',310,54),
            ('AIB','PO220375','SSEPA9002',360,211),
            ('AIB','PO220375','TRAPA9003',330,1078),
            ('AIB','PO220406','LSEPA9001',350,40),
            ('AIB','PO220406','LSEPA9001',390,100),
            ('AIB','PO220406','PINPA0147',500,191),
            ('AIB','PO220406','TABHD9000',10,870),
            ('AIB','PO220407','FUSHD9014',310,333),
            ('AIB','PO220407','LSEPA9001',360,660),
            ('AIB','PO220407','SSEPA9001',360,710),
            ('AIB','PO220407','TABHD9000',10,378),
            ('AIB','PO220461','H791007F',130,120),
            ('AIB','PO220462','H811001A',405,4),
            ('AIB','PO220462','H811004F',120,156),
            ('AIS','DU1301','TRBFA0040',null,881),
            ('AIS','PO210108','PICFA0016',15,676),
            ('AIS','PO210182','3031A4PT2',null,3),
            ('AIS','PO210183','3031A4PT3',null,3),
            ('AIS','PO210282','PICCO0021',null,144),
            ('AIS','PO210282','PICCO0022',null,144),
            ('AIS','PO210363','0124EN2P3',null,7),
            ('AIS','PO210594','3032CHEVC',null,18),
            ('AIS','PO210813S','PICMD0019',20,39),
            ('AIS','PO210814S','PICFA0027',8,166),
            ('AIS','PO210887','PICFA0027',15,205),
            ('AIS','PO210893R','USAMD0008',14,40),
            ('AIS','PO210906','PANHD0016',null,12),
            ('AIS','PO210911','0124V1032',null,1),
            ('AIS','PO210986','PICFA9000',10,105),
            ('AIS','PO210991R','H441009A',null,40),
            ('AIS','PO210991R3','H441009A',430,101),
            ('AIS','PO211011','3534L91Z',null,6),
            ('AIS','PO211011','CTFCH0075',80,139),
            ('AIS','PO211011','CTFCH0075',150,36),
            ('AIS','PO211055','PICFA0045',7,884),
            ('AIS','PO211055','PMAMD0001ST',1,510),
            ('AIS','PO211056','LEGFA0029',null,44),
            ('AIS','PO211056','PANHD0016',null,13),
            ('AIS','PO211056','PICFA0049',null,33),
            ('AIS','PO211057','DISFA0003',7,5110),
            ('AIS','PO211057','LEGFA0027',5,2545),
            ('AIS','PO211057','LEGFA0028',5,2532),
            ('AIS','PO211057','LEGFA0029',2,834),
            ('AIS','PO211057','LEGFA0029',3,1690),
            ('AIS','PO211057','PANHD0016',6,590),
            ('AIS','PO211057','PIBFA0042',3,2946),
            ('AIS','PO211057','PIBFA0042',4,187),
            ('AIS','PO211057','PIBFA0043',3,2632),
            ('AIS','PO211057','PIBFA0044',3,2612),
            ('AIS','PO211057','PIBFA0045',3,1841),
            ('AIS','PO211057','PMAMD0002',4,2581),
            ('AIS','PO211057','TRAFA0027',2,746),
            ('AIS','PO211057','TRAFA0027',3,2820),
            ('AIS','PO211057','TRAFA0028',1,2366),
            ('AIS','PO211057','TRAFA0028',2,200),
            ('AIS','PO211082','6010ARMOC',null,1),
            ('AIS','PO211086','6010SV1PC',null,36),
            ('AIS','PO211086R','USAMD0009',130,40),
            ('AIS','PO211086R1','LEGFA0002',8,95),
            ('AIS','PO211087','6009CO12C',null,66),
            ('AIS','PO211089','PICFA0016',15,48),
            ('AIS','PO211208','PICFA0022',11,190),
            ('AIS','PO211209','FSEMD0024',180,17),
            ('AIS','PO211221','FSEST0028',10,220),
            ('AIS','PO211221','PIBST0083',40,958),
            ('AIS','PO211224','ANMCO0026',10,44),
            ('AIS','PO211224','TRAST0029',130,72),
            ('AIS','PO211229','FSEMD0047',1,2400),
            ('AIS','PO211230','0124EN2P2',null,47),
            ('AIS','PO211261','MONST5001',null,529),
            ('AIS','PO211261','PICST5007',4,1060),
            ('AIS','PO211261','PICST5008',3,1050),
            ('AIS','PO211261','TRBST0094',5,1886),
            ('AIS','PO211261','TRBST0095',5,621),
            ('AIS','PO211262','MONMD0035',null,80),
            ('AIS','PO211280','PANFA0034',5,295),
            ('AIS','PO211285','3534L44Z',null,21),
            ('AIS','PO220115','FSEMD0023',200,14),
            ('AIS','PO220115','PICFA0022',14,27),
            ('AIS','PO220115','PLAPA0082',null,186),
            ('AIS','PO220117','6009SV1PC',null,17),
            ('AIS','PO220120','FSEMD0021',200,58),
            ('AIS','PO220120','FSEMD0024',200,145),
            ('AIS','PO220121','6010CO18C',null,44),
            ('AIS','PO220121','PICMD0005',22,100),
            ('AIS','PO220123','FSEMD0007',160,364),
            ('AIS','PO220123','FSEMD0008',160,365),
            ('AIS','PO220124','PICFA0016',15,32),
            ('AIS','PO220124','PICFA0019',14,385),
            ('AIS','PO220124','PICFA0024',11,127),
            ('AIS','PO220124','PICFA0024',14,300),
            ('AIS','PO220124','PICFA0027',14,124),
            ('AIS','PO220124','PICFA0027',15,19),
            ('AIS','PO220125','PSUMD0013',110,62),
            ('AIS','PO220126','PSUMD0010',110,154),
            ('AIS','PO220127','FSEMD0028',170,863),
            ('AIS','PO220128','LSEPA0059',8,833),
            ('AIS','PO220128','PICFA0016',14,443),
            ('AIS','PO220128','PICFA0019',15,277),
            ('AIS','PO220130','USAMD0003',16,64),
            ('AIS','PO220137','MONFA0001',1,168),
            ('AIS','PO220138S','FSEMD0010',160,20),
            ('AIS','PO220138S','FSEMD0028',170,150),
            ('AIS','PO220140','LEGFA0033',70,773),
            ('AIS','PO220140','TARFA0007',130,1537),
            ('AIS','PO220140','TRAFA0053',100,364),
            ('AIS','PO220140','TRAFA0053',130,1138),
            ('AIS','PO220145T','FSEST0029',40,49),
            ('AIS','PO220145T','LSECO0001',60,63),
            ('AIS','PO220145T','LSECO0002',60,62),
            ('AIS','PO220167','C071055T',70,216),
            ('AIS','PO220167','C071055T',90,211),
            ('AIS','PO220167','PICST0027',160,172),
            ('AIS','PO220167','PICST0028',150,176),
            ('AIS','PO220167','PICST0029',150,200),
            ('AIS','PO220167','PICST0030',150,204),
            ('AIS','PO220167','TRAST0028',130,429),
            ('AIS','PO220168','LEGFA0012',6,759),
            ('AIS','PO220168','MONFA0002',4,2386),
            ('AIS','PO220168','TARFA0002',7,1500),
            ('AIS','PO220168','TRAFA0013',8,1713),
            ('AIS','PO220168','TRAFA0014',4,1483),
            ('AIS','PO220169','MOBFA0001',3,1953),
            ('AIS','PO220169','MOBFA0001',5,190),
            ('AIS','PO220169','TRBFA0009',11,1550),
            ('AIS','PO220169','TRBFA0010',6,863),
            ('AIS','PO220169','TRBFA0010',7,757),
            ('AIS','PO220169','TRBFA0011',7,864),
            ('AIS','PO220169','TRBFA0011',8,221),
            ('AIS','PO220169','TRBFA0011',9,112),
            ('AIS','PO220169','TRBFA0011',10,515),
            ('AIS','PO220170','LEGFA0033',10,258),
            ('AIS','PO220170','LEGFA0033',20,514),
            ('AIS','PO220170','TARFA0007',10,168),
            ('AIS','PO220170','TARFA0007',20,1379),
            ('AIS','PO220170','TRAFA0053',20,1544),
            ('AIS','PO220172','H171006T',60,207),
            ('AIS','PO220172','H171006T',70,397),
            ('AIS','PO220172','H171006T',90,184),
            ('AIS','PO220172','SIPFA0002',30,1022),
            ('AIS','PO220181R','PICFA0038',3,299),
            ('AIS','PO220182','MEUHE0031',null,2),
            ('AIS','PO220214','LEGST0016',1,421),
            ('AIS','PO220214','PANST0132',5,26),
            ('AIS','PO220214','PICCO0040',2,206),
            ('AIS','PO220214','PICCO0041',1,206),
            ('AIS','PO220219','ALOST0001',1,365),
            ('AIS','PO220219','ALOST0002',1,360),
            ('AIS','PO220219','PLACO0001',60,181),
            ('AIS','PO220219','TARST0002',4,329),
            ('AIS','PO220219','TRACO0001',4,172),
            ('AIS','PO220219','TRACO0002',40,178),
            ('AIS','PO220219','TRAFA0003',1,185),
            ('AIS','PO220219','TRAFA0004',1,190),
            ('AIS','PO220219','TRAFA0006',2,321),
            ('AIS','PO220219','TRAFA0007',1,158),
            ('AIS','PO220220','PICCO0008',1,186),
            ('AIS','PO220220','PICCO0009',1,186),
            ('AIS','PO220220','PICCO0010',1,186),
            ('AIS','PO220220','PICCO0011',1,186),
            ('AIS','PO220220','TARST0003',1,202),
            ('AIS','PO220220','TARST0004',1,202),
            ('AIS','PO220220','TARST0005',null,193),
            ('AIS','PO220220','TARST0006',null,184),
            ('AIS','PO220221','PASTMC004',4,122),
            ('AIS','PO220221','PASTMC007',5,125),
            ('AIS','PO220221','PICST0012',10,221),
            ('AIS','PO220221','PICST0013',10,223),
            ('AIS','PO220221','PMAST0004',1,106),
            ('AIS','PO220221','TRAST0005',5,111),
            ('AIS','PO220222','LEMCO0020',50,471),
            ('AIS','PO220222','LSMCO0001',50,159),
            ('AIS','PO220222','PANST0105',4,156),
            ('AIS','PO220222','PIBST0046',6,277),
            ('AIS','PO220222','PIBST0047',6,277),
            ('AIS','PO220222','PLMCO0001',20,273),
            ('AIS','PO220222','SSMCO0001',110,240),
            ('AIS','PO220223','ANSST0026',5,30),
            ('AIS','PO220224','ANSST0026',5,35),
            ('AIS','PO220225','FSEMD0012',130,354),
            ('AIS','PO220225','FSEMD0014',140,309),
            ('AIS','PO220226','FSEMD0016',130,219),
            ('AIS','PO220226','FSEMD0016',140,186),
            ('AIS','PO220226','FSEMD0019',130,355),
            ('AIS','PO220227','USAMD0001',50,263),
            ('AIS','PO220228','USAMD0011',140,236),
            ('AIS','PO220229','LEGFA0001',100,471),
            ('AIS','PO220229','LEGFA0004',10,256),
            ('AIS','PO220229','PICFA0003',70,244),
            ('AIS','PO220229','PICFA0006',80,248),
            ('AIS','PO220229','PICFA0009',70,246),
            ('AIS','PO220229','USAMD0008',14,226),
            ('AIS','PO220230','FSEMD0026',141,526),
            ('AIS','PO220230','PICMD0013',19,267),
            ('AIS','PO220230','PICMD0014',18,272),
            ('AIS','PO220230','PICMD0015',19,214),
            ('AIS','PO220230','PICMD0016',19,265),
            ('AIS','PO220231','PSUMD0011',80,205),
            ('AIS','PO220232','FSEMD0017',140,195),
            ('AIS','PO220232','FSEMD0018',140,189),
            ('AIS','PO220233','PICMD0005',16,341),
            ('AIS','PO220233','PICMD0006',16,339),
            ('AIS','PO220233','USAMD0012',130,328),
            ('AIS','PO220234','PSUMD0006',160,78),
            ('AIS','PO220235','FSEMD0007',60,234),
            ('AIS','PO220235','FSEMD0008',60,238),
            ('AIS','PO220235','PICFA0016',8,232),
            ('AIS','PO220235','PICFA0019',8,231),
            ('AIS','PO220235','PICFA0024',8,231),
            ('AIS','PO220235','PICFA0027',8,232),
            ('AIS','PO220236','FSEMD0022',60,308),
            ('AIS','PO220236','FSEMD0025',60,306),
            ('AIS','PO220236','PICFA0016',8,238),
            ('AIS','PO220236','PICFA0019',8,232),
            ('AIS','PO220236','PICFA0024',8,237),
            ('AIS','PO220236','PICFA0027',8,235),
            ('AIS','PO220237','PSUMD0013',80,35),
            ('AIS','PO220237','PSUMD0013',110,99),
            ('AIS','PO220238','PSUMD0010',110,104),
            ('AIS','PO220239','LEGFA0003',8,630),
            ('AIS','PO220239','LEGFA0006',8,310),
            ('AIS','PO220239','PICFA0005',7,333),
            ('AIS','PO220239','PICFA0008',7,327),
            ('AIS','PO220239','PICFA0011',7,329),
            ('AIS','PO220239','PICFA0014',7,330),
            ('AIS','PO220239','USAMD0010',5,308),
            ('AIS','PO220239','USAMD0010',17,26),
            ('AIS','PO220240','FSEMD0009',60,310),
            ('AIS','PO220240','FSEMD0010',50,309),
            ('AIS','PO220240','PICFA0016',8,304),
            ('AIS','PO220240','PICFA0019',8,299),
            ('AIS','PO220240','PICFA0024',8,303),
            ('AIS','PO220240','PICFA0027',8,303),
            ('AIS','PO220241','PICMD0009',18,184),
            ('AIS','PO220241','PICMD0010',18,83),
            ('AIS','PO220241','PICMD0011',17,183),
            ('AIS','PO220241','PICMD0012',17,180),
            ('AIS','PO220241','USAMD0005',5,185),
            ('AIS','PO220244','3027CHEVC',null,29),
            ('AIS','PO220245','POFPA0385',5,205),
            ('AIS','PO220258','MONMD0029',7,336),
            ('AIS','PO220258','PLAPA0063',10,153),
            ('AIS','PO220258','PLAPA0064',10,120),
            ('AIS','PO220259','FSEPA0049',10,200),
            ('AIS','PO220259','PICFA0058',null,844),
            ('AIS','PO220259','SSEPA0002',8,190),
            ('AIS','PO220259','TARPA0001',7,186),
            ('AIS','PO220259','TARPA0002',7,410),
            ('AIS','PO220259','TARPA0003',13,355),
            ('AIS','PO220260','ADAFA5004',3,890),
            ('AIS','PO220294','PICST0016',10,245),
            ('AIS','PO220294','PICST0017',10,240),
            ('AIS','PO220294','PICST0018',12,244),
            ('AIS','PO220294','PICST0019',11,241),
            ('AIS','PO220296','LATFA0001',8,412),
            ('AIS','PO220296','PFAFA0001',8,176),
            ('AIS','PO220296','PICFA0038',3,450),
            ('AIS','PO220296','PICFA0038',5,129),
            ('AIS','PO220296','PSPFA0001',6,174),
            ('AIS','PO220296','PSPFA0002',7,169),
            ('AIS','PO220296','PSPFA0003',6,174),
            ('AIS','PO220299','CORMD0001',13,1514),
            ('AIS','PO220299','CORMD0002',13,752),
            ('AIS','PO220303','MONMD0005',140,1497),
            ('AIS','PO220303','MONMD0006',140,1467),
            ('AIS','PO220303','TRAMD0007',9,1716),
            ('AIS','PO220303','TRAMD0007',10,1588),
            ('AIS','PO220303','TRAMD0032',7,2289),
            ('AIS','PO220303','TRAMD0032',9,747),
            ('AIS','PO220308','TRAST0054',null,1444),
            ('AIS','PO220322','MONFA5000',200,158),
            ('AIS','PO220322','MONFA5001',200,170),
            ('AIS','PO220346','TRBFA0009',11,254),
            ('AIS','PO220360','SIPFA0007',12,412),
            ('AIS','PO220361','SIPST0001',7,461),
            ('AIS','PO220362','SIPST0010',50,660),
            ('AIS','PO220367','TRAST0066',4,284),
            ('AIS','PO220374','SIPFA0007',10,421),
            ('AIS','PO220375','ADAFA0016',50,248),
            ('AIS','PO220384','PICST0080',5,460),
            ('AIS','PO220384','PICST0081',4,184),
            ('AIS','PO220384','PICST0081',5,280),
            ('AIS','PO220385','MONST0008',40,214),
            ('AIS','PO220385','TRAST0073',null,170),
            ('AIS','PO220385','TRBST0062',5,241),
            ('AIS','PO220385','TRBST0063',5,951),
            ('AIS','PO220388','9019PARCC',1,3),
            ('AIS','PO220391','PLDPA0076',9,149),
            ('AIS','PO220391','PLDPA0076',90,292),
            ('AIS','PO220391','PLSPA0076',90,442),
            ('AIS','PO220391','TRAPA0063',20,330),
            ('AIS','PO220392','FSEMD0043',70,855),
            ('AIS','PO220392','MONMD0027',80,266),
            ('AIS','PO220392','MONMD0028',80,279),
            ('AIS','PO220392','TRAPA0103',30,296),
            ('AIS','PO220393','MONMD0015',70,307),
            ('AIS','PO220393','MONMD0016',70,308),
            ('AIS','PO220393','PLAPA0051',8,251),
            ('AIS','PO220393','PLAPA0052',8,301),
            ('AIS','PO220393','USAMD0016',5,610),
            ('AIS','PO220394','POFPA0386',7,250),
            ('AIS','PO220394','POFPA0387',7,177),
            ('AIS','PO220394','SSEPA0006',5,569),
            ('AIS','PO220395','FSEMD0040',5,501),
            ('AIS','PO220395','FSEMD0041',5,749),
            ('AIS','PO220395','MONMD0023',70,270),
            ('AIS','PO220395','MONMD0024',70,274),
            ('AIS','PO220395','PLAPA0059',9,248),
            ('AIS','PO220395','PLAPA0060',9,262),
            ('AIS','PO220395','SOCMD0006',3,526),
            ('AIS','PO220395','USAMD0023',5,509),
            ('AIS','PO220401','H171006T',50,960),
            ('AIS','PO220401','LEGFA0007',2,480),
            ('AIS','PO220401','LEGFA0008',2,480),
            ('AIS','PO220461','TRBFA0031',4,337),
            ('AIS','PO220463','ANSST0011',4,132),
            ('AIS','PO220463','COBFA0004',3,149),
            ('AIS','PO220463','COBFA0004',4,297),
            ('AIS','PO220464','ANSCO0032',1,69),
            ('AIS','PO220464','ANSCO0032',2,91),
            ('AIS','PO220464','ANSCO0032',6,50),
            ('AIS','PO220464','ANSST0001',4,1323),
            ('AIS','PO220465','COLFA0010',null,747),
            ('AIS','PO220466','TRBFA0005',3,3064),
            ('AIS','PO220468','ANSST0001',4,1404),
            ('AIS','PO220468','COLFA0010',null,718),
            ('AIS','PO220471','COLFA0010',null,481),
            ('AIS','PO220472','ANSCO0034',60,25),
            ('AIS','PO220472','ANSST0002',5,328),
            ('AIS','PO220472','ANSST0002',6,126),
            ('AIS','PO220478','FSEMD0007',10,190),
            ('AIS','PO220478','FSEMD0007',20,560),
            ('AIS','PO220478','FSEMD0008',10,783),
            ('AIS','PO220479','FSEMD0022',10,529),
            ('AIS','PO220484','FSEMD0021',20,428),
            ('AIS','PO220484','FSEMD0024',10,428),
            ('AIT','PO201269','PUNFE0934',null,31),
            ('AIT','PO210154','PUNFE1081',null,84),
            ('AIT','PO210157','PINPA0122',4,60),
            ('AIT','PO210157','PSPHD0012',4,37),
            ('AIT','PO210159','MTNPA0017',null,35),
            ('AIT','PO210159','TAPPA0012',null,19),
            ('AIT','PO210159','TAPPA0017',null,22),
            ('AIT','PO210159','TRAPA0074',null,6),
            ('AIT','PO210160','BLAPA0056',2,28),
            ('AIT','PO210163','PICPA0001',6,94),
            ('AIT','PO210165','PICFA0004',null,314),
            ('AIT','PO210168','POMPA0078',3,136),
            ('AIT','PO210364','ALOPA0013',null,14),
            ('AIT','PO210364','ANSME0005',null,20),
            ('AIT','PO210364','MOSMD0001',null,5),
            ('AIT','PO210364','PLDPA0043',null,6),
            ('AIT','PO210364','POMPA0085',null,4),
            ('AIT','PO210364R','PSUPA0072',6,46),
            ('AIT','PO210364R','PSUPA0072',8,132),
            ('AIT','PO210422','PUNFE0957',null,9),
            ('AIT','PO210515','PSUPA0062',null,33),
            ('AIT','PO210520','TRAPA0078',6,3),
            ('AIT','PO210523','SSEPA0001',null,53),
            ('AIT','PO210671','PUNFE0938',null,5),
            ('AIT','PO210682','POFPA0370',3,329),
            ('AIT','PO210683','PLAPA0023',5,15),
            ('AIT','PO210778','PSPHD0013',1,80),
            ('AIT','PO210781','BLAPA0056',5,9),
            ('AIT','PO210782','USAPA0079',5,7),
            ('AIT','PO210803','PICPA0003',5,121),
            ('AIT','PO210854','H741002T',6,26),
            ('AIT','PO210881','POMPA0027',null,5),
            ('AIT','PO210910','PSUPA0076',4,34),
            ('AIT','PO210973','ALOPA0042',5,158),
            ('AIT','PO211022','LEGPA0028',5,661),
            ('AIT','PO211022','PICPA0012',2,70),
            ('AIT','PO211022','TRAPA0053',5,630),
            ('AIT','PO211106','G351001T',90,17),
            ('AIT','PO211110','G351001T',40,34),
            ('AIT','PO211110','G351001T',50,14),
            ('AIT','PO211144A','ADAPR8001',10,30),
            ('AIT','PO211145','TABPR0001',10,795),
            ('AIT','PO211189','PUNFE0934',null,19),
            ('AIT','PO211189','PUNFE0959',null,7),
            ('AIT','PO211226','LATPR0002',1,53),
            ('AIT','PO211229','PEIPA0008',6,1731),
            ('AIT','PO211229','PLDPA0092',6,738),
            ('AIT','PO211229','PLSPA0092',6,1132),
            ('AIT','PO211231','LSEPA0035',5,5357),
            ('AIT','PO211231','LSEPA0035',6,230),
            ('AIT','PO211231','PINPA0109',4,948),
            ('AIT','PO211231','SSEPA0001',4,2784),
            ('AIT','PO211231','TRAPA0078',7,957),
            ('AIT','PO211264','FSEPA0045',6,30),
            ('AIT','PO211264','USAPA0085',5,9),
            ('AIT','PO211264','USAPA0086',5,57),
            ('AIT','PO211265','POMPA0113',null,23),
            ('AIT','PO211266','USAPA0081',4,12),
            ('AIT','PO211267','POMPA0110',2,105),
            ('AIT','PO211269','ADAPA0011',11,476),
            ('AIT','PO211269','USAPA0082',6,28),
            ('AIT','PO220092','ALOPA0039',4,16),
            ('AIT','PO220092','ALOPA0039',5,100),
            ('AIT','PO220110','PSUPA0073',60,153),
            ('AIT','PO220110','PSUPA0073',100,60),
            ('AIT','PO220110','PSUPA0073',120,24),
            ('AIT','PO220134','PSUPA0072',8,44),
            ('AIT','PO220138','PSUPA0072',8,15),
            ('AIT','PO220138','PSUPA0072',10,44),
            ('AIT','PO220138','PSUPA0072',12,176),
            ('AIT','PO220140','PSUPA0072',6,560),
            ('AIT','PO220140','PSUPA0072',7,9),
            ('AIT','PO220140','PSUPA0072',8,286),
            ('AIT','PO220140','PSUPA0072',10,264),
            ('AIT','PO220140','PSUPA0072',11,44),
            ('AIT','PO220140','PSUPA0072',12,264),
            ('AIT','PO220170','PSUPA0072',2,1063),
            ('AIT','PO220170','PSUPA0072',3,513),
            ('AIT','PO220175','BLAPA0075',70,1026),
            ('AIT','PO220175','PICPA0018',70,1026),
            ('AIT','PO220175','PICPA0019',70,1034),
            ('AIT','PO220175','PICPA0020',7,1036),
            ('AIT','PO220175','PICPA0021',7,1044),
            ('AIT','PO220175','PICPA0022',7,350),
            ('AIT','PO220175','PICPA0022',70,721),
            ('AIT','PO220175','TRAPA0113',50,1003),
            ('AIT','PO220177','ADAPA0014',10,510),
            ('AIT','PO220177','BLAPA0075',40,1046),
            ('AIT','PO220177','PICPA0018',60,1038),
            ('AIT','PO220177','PICPA0019',60,1042),
            ('AIT','PO220177','PICPA0020',20,1080),
            ('AIT','PO220177','PICPA0021',20,1056),
            ('AIT','PO220177','PICPA0022',30,1047),
            ('AIT','PO220177','TRAPA0113',10,840),
            ('AIT','PO220177','TRAPA0114',30,522),
            ('AIT','PO220178','ALOPA0043',40,2134),
            ('AIT','PO220225','LEGPA0047',3,864),
            ('AIT','PO220225','SPSPA0033',6,336),
            ('AIT','PO220226','LEGPA0049',3,708),
            ('AIT','PO220226','PLAPA0082',6,722),
            ('AIT','PO220226','SPSPA0037',8,256),
            ('AIT','PO220226','SPSPA0074',7,372),
            ('AIT','PO220227','POMPA0132',6,199),
            ('AIT','PO220228','PLAPA0086',3,108),
            ('AIT','PO220228','PLAPA0086',6,292),
            ('AIT','PO220229','LEGPA0067',6,243),
            ('AIT','PO220229','PLAPA0084',5,473),
            ('AIT','PO220230','LSEPA0062',6,1231),
            ('AIT','PO220230','SPSPA0034',8,519),
            ('AIT','PO220232','LEGPA0049',7,446),
            ('AIT','PO220232','PLAPA0071',6,142),
            ('AIT','PO220232','SPSPA0048',10,231),
            ('AIT','PO220233','PLAPA0069',6,652),
            ('AIT','PO220234','ANSCP0414',1,108),
            ('AIT','PO220235','LEGPA0049',1,504),
            ('AIT','PO220235','PLAPA0076',2,456),
            ('AIT','PO220235','SPSPA0070',1,132),
            ('AIT','PO220235','SPSPA0076',1,250),
            ('AIT','PO220236','PITPA0098',1,255),
            ('AIT','PO220236','PLAPA0076',2,489),
            ('AIT','PO220236','SPSPA0071',1,480),
            ('AIT','PO220236','SPSPA0072',1,522),
            ('AIT','PO220237','ANSCP0411',1,108),
            ('AIT','PO220239','LEGPA0066',1,312),
            ('AIT','PO220239','PINPA0142',2,325),
            ('AIT','PO220239','PLAPA0078',2,600),
            ('AIT','PO220239','POMPA0130',1,248),
            ('AIT','PO220240','LEGPA0047',1,608),
            ('AIT','PO220240','LSEPA0059',2,1206),
            ('AIT','PO220240','PLAPA0076',2,611),
            ('AIT','PO220240','SPSPA0068',1,318),
            ('AIT','PO220240','SPSPA0069',2,312),
            ('AIT','PO220241','PINPA0144',1,192),
            ('AIT','PO220241','PLAPA0080',2,356),
            ('AIT','PO220241','POFPA0390',1,198),
            ('AIT','PO220241','POMPA0119',1,384),
            ('AIT','PO220241','PSUPA0086',1,185),
            ('AIT','PO220243','LPAPA0028',6,562),
            ('AIT','PO220249','FUSME0026',1,236),
            ('AIT','PO220249','TRAPA0064',2,196),
            ('AIT','PO220250','PITPA0061',3,186),
            ('AIT','PO220251','PLDPA0077',4,181),
            ('AIT','PO220251','PLSPA0077',4,288),
            ('AIT','PO220251','PLSPA0077',5,42),
            ('AIT','PO220254','LSEPA0027',1,1540),
            ('AIT','PO220254','LSEPA0028',1,1395),
            ('AIT','PO220254','PINPA0100',1,467),
            ('AIT','PO220254','PITPA0066',1,459),
            ('AIT','PO220254','PITPA0067',1,46),
            ('AIT','PO220256','PLDPA0095',1,553),
            ('AIT','PO220256','PLSPA0095',1,592),
            ('AIT','PO220299','PINPA0110',2,783),
            ('AIT','PO220299','POFPA0370',2,3071),
            ('AIT','PO220299','PSUPA0062',2,768),
            ('AIT','PO220301','PLAPA0023',2,1103),
            ('AIT','PO220301','PLAPA0023',3,454),
            ('AIT','PO220376','ANSCP0438',1,350),
            ('AIT','PO220376','PSUPA0072',6,266),
            ('AIT','PO220376','PSUPA0072',10,88),
            ('AIT','PO220376','PSUPA0072',11,132),
            ('AIT','PO220376','PSUPA0072',12,352),
            ('AIT','TH2301','TRAPA0084',7,201);

    /* update tbl_tmp_wip_pozitions as a
    set faza = (case when b.faza_penultima~E'^\\d+$' then b.faza_penultima::int else a.faza end)
    from (
        select distinct
            b1."Prod_ Order No_",
            b1."Item No_",
            lag(b2."Operation No_", 1) over (partition by b1."Prod_ Order No_", b1."Item No_" order by b2."Operation No_" desc) as faza_penultima
        from nav.tbl_int_prod_order_line as b1
        inner join nav.tbl_int_prod_order_routing_line as b2
        on b1."Prod_ Order No_" = b2."Prod_ Order No_" and b1."Line No_" = b2."Routing Reference No_"
    ) as b
    where a.comanda = b."Prod_ Order No_" and a.reper = b."Item No_" and
        not exists (
            select
                *
            from nav.tbl_int_prod_order_line as c1
            inner join nav.tbl_int_prod_order_routing_line as c2
            on c1."Prod_ Order No_" = c2."Prod_ Order No_" and c1."Line No_" = c2."Routing Reference No_"
            where c1."Prod_ Order No_" = a.comanda and c1."Item No_" = a.reper and
            (case when c2."Operation No_"~E'^\\d+$' then c2."Operation No_"::int else null end) = a.faza
        ); */

    /*******************************************************/
    /*create temp table tbl_tmp_values as
    select
        x.*,
        (x.cost_cantitate * _tarif_orar) as valoare
    from (
        select
            a.locatie,
            a.comanda,
            a.reper,
            a.faza,
            a.cantitate as reper_cantitate,
            'ORE' as sursa_valoare,
            round(sum(c."Workers Qty_" / case c."Output Quantity" when 0 then coalesce(nullif(b."Quantity", 0::decimal), a.cantitate)
                                                                else c."Output Quantity" end) * a.cantitate, 2) as cost_cantitate
        from tbl_tmp_wip_pozitions as a

        inner join nav.tbl_int_prod_order_line as b
        on a.comanda = b."Prod_ Order No_" and a.reper = b."Item No_"
        
        inner join nav.tbl_int_capacity_ledger_entry as c
        on b."Prod_ Order No_" = c."Order No_" and b."Line No_" = c."Order Line No_" and
            (case when c."Operation No_"~E'^\\d+$' then c."Operation No_"::int else null end)::text <= a.faza::text

        where a.faza is not null and c."Posting Date"::date <= _by_date

        group by a.locatie, a.comanda, a.reper, a.faza, a.cantitate
    ) as x;*/


    /*******************************************************/
    create temp table tbl_tmp_values as
    select
        a.locatie,
        a.comanda,
        b."Location Code",
        a."Work Center No_",
        a.reper,
        a.faza,
        a.cantitate as reper_cantitate,
        a."Line No_",
        a."Routing Link Code",
        b."Item No_",
        b."Description" as "Item Name",
        b."Inventory Posting Group",
        b."Base Unit of Measure",
        b."Unit Cost",
        round(b."Quantity per" * a.cantitate, 2) as "Quantity"
    from (
        select
            a1.locatie,
            a1.comanda,
            a1.reper,
            a1.faza,
            a1.cantitate,
            a2."Line No_",
            a3."Work Center No_",
            a3."Routing Link Code",
            a2."Quantity" as "Expected Quantity",
            coalesce(a4."Output Quantity", 0) as "Output Quantity"
        from tbl_tmp_wip_pozitions as a1

        inner join nav.tbl_int_prod_order_line as a2
        on a1.comanda = a2."Prod_ Order No_" and a1.reper = a2."Item No_"

        inner join nav.tbl_int_prod_order_routing_line as a3
        on a2."Prod_ Order No_" = a3."Prod_ Order No_" and a2."Line No_" = a3."Routing Reference No_" and nullif(a3."Routing Link Code", '') is not null and
        (case when a3."Operation No_"~E'^\\d+$' then a3."Operation No_"::int else null end)::text > a1.faza::text

        left join lateral (
            select
                sum(a4_1."Output Quantity") as "Output Quantity"
            from nav.tbl_int_capacity_ledger_entry as a4_1
            where a4_1."Order No_" = a3."Prod_ Order No_" and a4_1."Order Line No_" = a3."Routing Reference No_" and a4_1."Operation No_" = a3."Operation No_" and
                a4_1."Posting Date"::date <= '2022-03-31'::date
        ) as a4
        on true
    ) as a

    left join lateral (
        select
            b1."Item No_",
            b2."Description",
            b2."Inventory Posting Group",
            b1."Location Code",
            (b1."Quantity per" * coalesce(b3."Qty_ per Unit of Measure", 1)) as "Quantity per",
            b2."Base Unit of Measure",
            b2."Unit Cost"
        from nav.tbl_int_prod_order_component as b1

        inner join nav.tbl_int_item as b2
        on b1."Item No_" = b2."No_"

        left join nav.tbl_int_item_umas as b3
        on b3."Item No_" = b1."Item No_" and b3."Code" = b1."Unit of Measure Code"

        where b1."Prod_ Order No_" = a.comanda and b1."Prod_ Order Line No_" = a."Line No_" and b1."Routing Link Code" = a."Routing Link Code"
    ) as b
    on true;
end;
$$ language plpgsql;

select * from tbl_tmp_values;